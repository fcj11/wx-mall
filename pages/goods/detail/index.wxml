<view class="detail-container">
  <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
  <swiper class="goods-swiper" 
          indicator-dots 
          circular
          indicator-active-color="#ff2d4a"
          bindchange="handleSwiperChange">
    <swiper-item wx:for="{{goods.images}}" wx:key="*this">
      <image src="{{item}}" 
             mode="aspectFill" 
             class="goods-image"
             bindtap="handleImageClick"/>
    </swiper-item>
    <view class="swiper-index">{{currentIndex + 1}}/{{goods.images.length}}</view>
  </swiper>

  <!-- å•†å“ä¿¡æ¯ -->
  <view class="goods-info">
    <view class="price-section">
      <view class="price-box">
        <text class="price-symbol">Â¥</text>
        <text class="price">{{goods.price}}</text>
        <text class="original-price">Â¥{{goods.originalPrice}}</text>
      </view>
      <view class="share-btn" bindtap="handleShare">
        <text class="share-icon">ğŸ“¤</text>
        <text>åˆ†äº«</text>
      </view>
    </view>
    <view class="title">{{goods.title}}</view>
    <view class="desc">{{goods.desc}}</view>
    <view class="sales-box">
      <text class="sales">é”€é‡ {{goods.sales}}</text>
      <text class="express">å¿«é€’: å…è¿è´¹</text>
    </view>
    <view class="goods-action">
      <view class="action-item" bindtap="handleCollect">
        <text class="iconfont {{isCollected ? 'icon-collected' : 'icon-collect'}}"></text>
        <text>{{isCollected ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
      </view>
    </view>
  </view>

  <!-- å•†å“è§„æ ¼ -->
  <view class="specs-section" bindtap="showSpecsPopup">
    <view class="section-title">è§„æ ¼</view>
    <view class="specs-preview">
      <text>é€‰æ‹©: é¢œè‰²ã€å°ºç </text>
      <text class="arrow">></text>
    </view>
  </view>

  <!-- å•†å“è¯„ä»· -->
  <view class="reviews-section">
    <view class="section-header">
      <view class="section-title">å•†å“è¯„ä»·</view>
      <view class="more" bindtap="handleMoreReviews">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="count">({{goods.reviewCount}})</text>
        <text class="arrow">></text>
      </view>
    </view>
    <view class="reviews-list" wx:if="{{goods.reviews.length > 0}}">
      <view class="review-item" wx:for="{{goods.reviews}}" wx:key="id">
        <image class="avatar" src="{{item.avatar}}" mode="aspectFill"/>
        <view class="review-content">
          <view class="review-header">
            <text class="username">{{item.username}}</text>
            <text class="date">{{item.date}}</text>
          </view>
          <view class="review-text">{{item.content}}</view>
          <view class="review-images" wx:if="{{item.images.length > 0}}">
            <image wx:for="{{item.images}}" 
                   wx:key="*this" 
                   wx:for-item="img"
                   src="{{img}}" 
                   mode="aspectFill"
                   bindtap="handleReviewImageClick"
                   data-urls="{{item.images}}"
                   data-current="{{img}}"/>
          </view>
        </view>
      </view>
    </view>
    <view class="no-reviews" wx:else>æš‚æ— è¯„ä»·</view>
  </view>

  <!-- å•†å“è¯¦æƒ… -->
  <view class="detail-section">
    <view class="section-title">å•†å“è¯¦æƒ…</view>
    <view class="detail-content">
      <rich-text nodes="{{goods.detail}}"></rich-text>
      <image wx:for="{{goods.detailImages}}" 
             wx:key="*this"
             src="{{item}}"
             mode="widthFix"
             class="detail-image"
             lazy-load/>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <view class="action-buttons">
      <view class="action-item" bindtap="handleHomeClick">
        <text class="icon">ğŸ </text>
        <text>é¦–é¡µ</text>
      </view>
      <view class="action-item" bindtap="handleFavoriteClick">
        <text class="icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text>æ”¶è—</text>
      </view>
      <view class="action-item" bindtap="handleCartClick">
        <text class="icon">ğŸ›’</text>
        <text>è´­ç‰©è½¦</text>
        <view class="cart-badge" wx:if="{{cartCount > 0}}">{{cartCount}}</view>
      </view>
    </view>
    <view class="buy-buttons">
      <button class="add-cart" 
              bindtap="handleAddCart" 
              hover-class="none">åŠ å…¥è´­ç‰©è½¦</button>
      <button class="buy-now" 
              bindtap="handleBuyNow"
              hover-class="none">ç«‹å³è´­ä¹°</button>
    </view>
  </view>

  <!-- è§„æ ¼é€‰æ‹©å¼¹çª— -->
  <view class="specs-popup {{showSpecs ? 'show' : ''}}" catchtouchmove="preventTouchMove">
    <view class="popup-mask" bindtap="hideSpecsPopup"></view>
    <view class="popup-content">
      <view class="popup-header">
        <image class="goods-thumb" src="{{goods.images[0]}}" mode="aspectFill"/>
        <view class="selected-info">
          <view class="selected-price">Â¥{{goods.price}}</view>
          <view class="selected-specs">è¯·é€‰æ‹©è§„æ ¼</view>
        </view>
        <view class="close-btn" bindtap="hideSpecsPopup">Ã—</view>
      </view>
      <scroll-view scroll-y class="specs-list">
        <!-- é¢œè‰²é€‰æ‹© -->
        <view class="specs-group">
          <view class="group-title">é¢œè‰²</view>
          <view class="specs-options">
            <text class="spec-item {{colorIndex === index ? 'active' : ''}}"
                  wx:for="{{specs.colors}}"
                  wx:key="*this"
                  bindtap="handleColorSelect"
                  data-index="{{index}}">{{item}}</text>
          </view>
        </view>
        <!-- å°ºç é€‰æ‹© -->
        <view class="specs-group">
          <view class="group-title">å°ºç </view>
          <view class="specs-options">
            <text class="spec-item {{sizeIndex === index ? 'active' : ''}}"
                  wx:for="{{specs.sizes}}"
                  wx:key="*this"
                  bindtap="handleSizeSelect"
                  data-index="{{index}}">{{item}}</text>
          </view>
        </view>
        <!-- æ•°é‡é€‰æ‹© -->
        <view class="specs-group">
          <view class="group-title">æ•°é‡</view>
          <view class="quantity-selector">
            <text class="minus {{quantity <= 1 ? 'disabled' : ''}}" 
                  bindtap="handleQuantityMinus">-</text>
            <input class="quantity" 
                   type="number" 
                   value="{{quantity}}"
                   bindblur="handleQuantityInput"/>
            <text class="plus" bindtap="handleQuantityPlus">+</text>
          </view>
        </view>
      </scroll-view>
      <view class="popup-buttons">
        <button class="confirm-btn" bindtap="handleSpecsConfirm">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view> 